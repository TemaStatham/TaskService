<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка файла</title>
</head>
<body>
<h2>Отправка файла</h2>
<form id="uploadForm">
    <label for="task_id">Task ID:</label>
    <input type="number" id="task_id" name="task_id" required><br><br>

    <label for="user_id">User ID:</label>
    <input type="number" id="user_id" name="user_id" required><br><br>

    <label for="file">Выберите файл:</label>
    <input type="file" id="file" name="file" required><br><br>

    <button type="submit">Отправить</button>
</form>

<p id="response"></p>

<script>
    document.getElementById('uploadForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const taskId = document.getElementById('task_id').value;
        const userId = document.getElementById('user_id').value;
        const fileInput = document.getElementById('file').files[0];

        if (!fileInput) {
            alert("Выберите файл перед отправкой!");
            return;
        }

        const reader = new FileReader();
        reader.readAsDataURL(fileInput);
        reader.onload = async function() {
            const fileData = reader.result.split(',')[1]; // Получаем Base64-кодировку

            const requestBody = {
                task_id: parseInt(taskId),
                user_id: parseInt(userId),
                file: fileData
            };
            const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJyb2xlIjoiIiwiZXhwIjoxNzQyNDY3ODA2fQ.Zw_8YoXHoSFwoM4UUmYUrGbkVIAUk8KM0SElxXTrf7Q'

            const response = await fetch('http://localhost:8080/api/approves/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                },
                body: JSON.stringify(requestBody)
            });

            const result = await response.json();
            document.getElementById('response').innerText = JSON.stringify(result, null, 2);
        };
    });
</script>
</body>
</html>
